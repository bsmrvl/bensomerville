function navShown(e){e?(expand.className="expnd",setTimeout(()=>{dropdown.innerHTML="Explore"},200),expanded=!0):(expand.className="clpsd",dropdown.innerHTML="E",expanded=!1)}function refresh(e,t=!1){var n=e.indexOf("-/");n>-1?(link=e.substring(n+2,e.length),e=e.substring(0,n),e===lastUrl&&(document.dispatchEvent(linkchange),t?window.history.replaceState("hist","","/p/"+e+"-/"+link):window.history.pushState("new","","/p/"+e+"-/"+link))):link="",e!==lastUrl&&(lastUrl=e,loadPage(e,t))}function mLink(e){var t,n,a=e.indexOf("#");return a>-1?(t=e.substring(a+1,e.length),(n=tracks.find(e=>e.songid===t))?(playlist=window[n.albumid].concat(),playhead=playlist.indexOf(t),playNew()):alert("no such track"),e.substring(0,a)):e}function request(e,t,n=null,a){var s=new XMLHttpRequest;s.open(t,e),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=(()=>{4===s.readyState&&(200===s.status?a(s.responseText):console.log("Error: "+s.status))}),s.send(n)}function onPlatter(html){var afterhead=html.substring(html.indexOf("</head>")+7,html.length+1),scr=afterhead.substring(afterhead.indexOf("<script>")+8,afterhead.indexOf("</script>"));pageContent.innerHTML=afterhead,eval(scr)}function loadPage(e,t){function n(n){onPlatter(n);var a="/p/"+e+(link&&"-/"+link);t?window.history.replaceState("hist","",a):window.history.pushState("new","",a),linkElement&&(linkElement.style.cursor="")}linkElement&&(linkElement.style.cursor="wait"),document.removeEventListener("linkchange",poemp),document.removeEventListener("linkchange",songp),document.removeEventListener("linkchange",seshp),bgFocus&&toggleBG(),request("/load_page.php","POST","page="+e,n)}function loadJson(e,t){var n=new XMLHttpRequest;n.open("GET",e+".json"),n.onreadystatechange=(()=>{if(4===n.readyState)if(200===n.status){var e=JSON.parse(n.responseText);t(e)}else console.log("error: "+n.status)}),n.send()}function squery(e,t){return`SELECT * FROM ${e} WHERE tid = "${t}";`}function query(e,t){function n(e){t(JSON.parse(e)),linkElement&&(linkElement.style.cursor="")}linkElement&&(linkElement.style.cursor="wait"),request("/query.php","POST",`q=${e}`,n)}function poemp(){query(squery("poems",link),loadPoem)}function songp(){query(squery("songs",link),loadSong)}function seshp(){query(squery("sessions",link),loadSession)}function loadPoem(e){document.getElementById("sTitle").innerHTML=e.title,document.getElementById("sText").innerHTML=e.words}function loadSong(e){var t=tracks.find(e=>e.songid===link);document.getElementById("lPlay").setAttribute("name",t.songid),document.getElementById("lTitle").innerHTML=e.title,document.getElementById("lText").innerHTML=e.words;var n=document.getElementById("lAlbum");n.innerHTML=t.album,n.setAttribute("href","/p/album/"+t.albumid),setImageEvent("/"+e.img);var a=document.getElementsByClassName("internal2");for(let e=0;e<a.length;e++)a[e].addEventListener("click",intLink)}function loadSession(e){canv.style.backgroundSize="contain",setImageEvent("/"+e.img),document.querySelector(".backcanvas").style.backgroundImage="url(/"+e.img+")",e.v?canv.style.backgroundRepeat="no-repeat":canv.style.backgroundRepeat="repeat-x",document.getElementById("sDate").innerHTML=e.dat,document.getElementById("sLoc").innerHTML=e.loc,document.getElementById("sRec").innerHTML=e.rec;for(var t=document.getElementsByClassName("internal2"),n=0;n<t.length;n++)t[n].addEventListener("click",intLink)}function toggleBG(){bgFocus?(pageContent.style.zIndex=0,document.querySelector(".backcanvas").style.zIndex=-7,canv.style.zIndex=0,bgFocus=!1):(pageContent.style.zIndex=50,document.querySelector(".backcanvas").style.zIndex=50,canv.style.zIndex=55,bgFocus=!0)}function setBgToggle(){canv.removeEventListener("click",toggleBG),bgFocus=!1,canv.addEventListener("click",toggleBG)}function loadPosts(e){function t(a){var s=document.createElement("p");s.innerHTML="<br><hr noshade color='#eeeeee'><br><br>",postBlock.appendChild(s);var r=document.createElement("div");r.setAttribute("class","blogpost"),postBlock.appendChild(r);var o=document.createElement("div");o.setAttribute("class","postdate"),o.innerHTML=a.date,r.appendChild(o);var i=document.createElement("div");r.appendChild(i);var l=document.createElement("div");l.setAttribute("class","posttitle");var d=document.createElement("a");d.setAttribute("class","internal2"),d.setAttribute("href",a.link),d.innerHTML=a.title,l.appendChild(d),i.appendChild(l);var c=document.createElement("div");c.setAttribute("class","postsample"),c.innerHTML=a.sample,i.appendChild(c),i.appendChild(document.createElement("br"));var u=document.createElement("a");u.setAttribute("class","internal2"),u.setAttribute("href",a.link);var m=document.createElement("span");if(m.setAttribute("class","postlink"),u.appendChild(m),r.appendChild(u),n++,n<e.length)loadJson("/js/posts/"+e[n],t);else{postList.appendChild(postBlock);var g=document.getElementsByClassName("internal2");for(let e=0;e<g.length;e++)g[e].addEventListener("click",intLink)}}var n=0;postList=document.getElementsByClassName("blogposts")[0],postBlock=document.createElement("div"),loadJson("/js/posts/"+e[n],t)}function readyHandler(){document.dispatchEvent(readyforaudio),fullReady=!0}function setImageEvent(e,t){function n(){canv.style.backgroundImage="url("+e+")",theImage.src=e,console.log(theImage.src)}fullReady=!1,document.dispatchEvent(newimage),t?(document.removeEventListener(t,n),document.addEventListener(t,n,{once:!0})):n()}function intLink(e){e.preventDefault(),linkElement=e.target;var t=e.currentTarget.getAttribute("href"),n=t.indexOf("/p/");refresh(n>-1?t.substring(n+3,t.length+1):"home")}function setExtPlayers(e){for(let t=0;t<e.length;t++)e[t].addEventListener("click",e=>{var t=e.currentTarget.getAttribute("href");(t.includes("soundcloud")||t.includes("spotify")||t.includes("youtu"))&&pauser()})}function resetInternals(e){for(let t=0;t<e.length;t++)e[t].removeEventListener("click",intLink),e[t].addEventListener("click",intLink)}function setPlayers(e){for(let t=0;t<e.length;t++)e[t].addEventListener("click",e=>{e.stopPropagation();let t=e.currentTarget.getAttribute("name"),n=window[e.currentTarget.getAttribute("data-list")]||window[tracks.find(e=>e.songid===t).albumid];playlist=n.concat(),playhead=playlist.indexOf(t),playNew("",!0)})}function updateHeight(e,t){var n=e.offsetHeight+200;n>window.innerHeight?t.style.height=n+"px":t.style.height=window.innerHeight+"px"}function onPageLoad(e="Ben Somerville",t={path:null,pos:null,siz:null,rep:null},n){document.title=e,cont=document.getElementById("content"),canv=document.getElementById("canvas"),t.path&&setImageEvent(t.path,n),t.pos&&(canv.style.backgroundPosition=t.pos),t.siz&&(canv.style.backgroundSize=t.siz),t.rep&&(canv.style.backgroundRepeat=t.rep);var a=document.getElementsByTagName("a");setExtPlayers(a);var s=document.getElementsByClassName("internal");resetInternals(s);var r=document.getElementsByClassName("player");setPlayers(r),cont&&new ResizeSensor(cont,()=>updateHeight(cont,canv)),window.scroll(0,0)}var cont,canv,linkElement,dropdown=document.getElementById("mobileexplore"),expand=document.getElementById("expand"),expanded;dropdown.addEventListener("click",e=>{e.stopPropagation(),navShown(!expanded),document.body.addEventListener("click",()=>navShown(!1))}),expand.className="clpsd",setTimeout(()=>expand.style.transition="height .2s, width .2s",200),expanded=!1;var lastUrl="",link="",linkchange=new CustomEvent("linkchange");window.addEventListener("popstate",function(){url=window.location.href;var e,t=url.indexOf("/p/");t>-1&&(e=url.substring(t+3,url.length+1)),window.location.hash?window.history.replaceState("song","","/p/"+mLink(e)):refresh(t>-1?e:"home",!0)});var pageContent=document.getElementById("pageContent"),bgFocus=!1,theImage=new Image,newimage=new CustomEvent("newimage"),readyforaudio=new CustomEvent("readyforaudio"),fullReady=!1;theImage.addEventListener("load",readyHandler);for(var shuffless=document.getElementsByClassName("shuffles"),i=0;i<shuffless.length;i++)shuffless[i].addEventListener("click",e=>{e.preventDefault(),linkElement=e.target;var t=window[e.currentTarget.getAttribute("name")];if(t){var n=t[Math.floor(Math.random()*t.length)];refresh(t===albums?"album/"+n:e.currentTarget.getAttribute("name")+"-/"+n)}});newShuffle(),null===sessionStorage.getItem("firstpage")?refresh("home"):(refresh(mLink(sessionStorage.getItem("firstpage"))),sessionStorage.removeItem("firstpage"));var albums=["quarry","eastcoast","entanglement","euwCondensed","euw","greenstone","stainless"],song=["tripwired2","tripwired2","eastcoast","eastcoast","tension","tension","diminishing","diminishing","stage","stage","pullmeapart","pullmeapart","rest","rest","mrforeigner","mrforeigner","imaginarypain","imaginarypain","togive","togive","ithought","ithought","father","father","cyclopath","srj","topsong","thatsano","sirdoubts","changesomeone","fatedelay","twoeyes","postal","wheelless","anystar","gb","barcode","hireamaid","stairs","patricians","contraspective","pretensent","whatexcuse","fortuneteller","backbend","becky","manna","manna","counterprofeit","counterprofeit","concavescent","concavescent","tripwired","tripwired","endothermic","endothermic"],session=["2211","2213","3131","3132","3133","3141","3142","3143","3151","3152","3251","3252","3253","3254","3255","4051","4052","4053","4054","4055","4056","4057","4058","4071","4111","4112","4113","4151","4152","4153","4154","4181","4182","4221","4271","4272","4281","5021","5022","5041","5042","5043","5061","5131","5221","5281","5291","6021","6022"],poem=["anystar","comedown","comedown2","endyourreign","everest","evolve1","evolve2","geometry","icynight","incensesmoke","intellectual","lovesmiles","tomoon","wetpaint"];
var currentList,displayedList,temp,nextTrack,$a,$aSrc,$scrub,$scrubvis,listIndex=0,current=0,ready=1,scrubbing=!1;function a(t){return $a.get(t)}function prev(t){if(t.cancelable&&t.preventDefault(),a(current).currentTime>3)a(current).currentTime=0;else if(listIndex>0){var e=!a(current).paused;pauser();var r=tracks.find(t=>t.songid===currentList[listIndex-1]);loadAudio(r),showTrack(r),listIndex-=1,playNow(e)}}function playpause(){a(current).paused?a(current).play():pauser()}function next(t){if(t.cancelable&&t.preventDefault(),listIndex<currentList.length-1){var e=!a(current).paused;pauser(),a(current).readyState<4?(loadAudio(nextTrack),showTrack(nextTrack)):showTrack(nextTrack),listIndex+=1,playNow(e)}}function pauser(){a(current).pause()}function playNew(t,e=!a(current).paused){pauser(),t||(t=currentList[listIndex]);var r=tracks.find(e=>e.songid===t);loadAudio(r),showTrack(r),playNow(e)}function getNext(){return tracks.find(t=>t.songid===currentList[listIndex+1])}function loadAudio(t,e=!1){nextTrack=t,e?$a.eq(current).one("canplaythrough",(function(){$aSrc.eq(ready).attr("src",t.filePath),a(ready).load()})):($aSrc.eq(ready).attr("src",t.filePath),a(ready).load())}function showTrack(t){temp=current,current=ready,ready=temp,4!=a(current).readyState&&($("#tracktime").hide(),$("#aLoading").show()),$("#pCover").attr("src",t.coverPath),$("#pName").html(t.songname),$("#pAlbum").html(t.album),$("#tracklength").html(t.runtime),t.spotify?$("#pSpot").attr("href",t.spotify).show():$("#pSpot").hide(),t.youtube?$("#pYou").attr("href",t.youtube).show():$("#pYou").hide(),t.soundcloud?$("#pSC").attr("href",t.soundcloud).show():$("#pSC").hide()}function playNow(t=!0){if(t&&a(current).play(),listIndex<currentList.length-1){var e=!1;a(current).readyState<4&&(e=!0),loadAudio(getNext(),e)}seekUpdate()}function scrubber(t){t.cancelable&&t.preventDefault(),scrubbing=!0;var e,r,n=$scrubvis.offset().left-t.clientX,c=a(current).duration-.01,i=$("#seekbar").offset().left,u=$("#seekbar").width(),o=!a(current).paused;pauser(),$(document).on("pointermove",(function(t){t.cancelable&&t.preventDefault(),(e=t.clientX+n)<i?(scrubPosition(0),r=0):e>i+u?(scrubPosition(u),r=c):(scrubPosition(e-i),r=(e-i)/u*c),$("#tracktime").html(minSec(r))})),$(document).one("pointerup",(function(t){$(document).off("pointermove"),a(current).currentTime=r,o&&a(current).play(),scrubbing=!1}))}function seekUpdate(){scrubbing||(scrubPosition(a(current).currentTime/a(current).duration*$("#seekbar").width()),$("#tracktime").html(minSec(a(current).currentTime)))}function scrubPosition(t){$scrub.css("left",t-15+"px"),$scrubvis.css("left",t+"px")}function minSec(t){var e=Math.floor(t/60).toString(),r=Math.floor(t%60).toString();return 1==r.length&&(r="0"+r),e+":"+r}function fillTrackRow(t,e,r){e.attr({id:r.songid,"data-listIndex":t+1,class:"player"});var n=$("<td></td>").html(t+1),a=$("<td></td>").html(r.songname),c=$("<td></td>").html(r.runtime),i=$("<td></td>");if(e.append(n,a,c,i),"n"==r.instrumental){var u=$("<a></a>").html("Lyrics");u.attr("href","#songs/"+r.songid),i.append(u)}}function trackList(t){displayedList=t;for(var e=0;e<t.length;e++){var r=tracks.find(r=>r.songid===t[e]),n=$("<tr></tr>");$(".tracklist").append(n),fillTrackRow(e,n,r)}$("tr a").click((function(){return window.location.assign("/"+$(this).attr("href")),!1}))}function shuffler(){for(var t=[],e=0;e<10;e++){var r=!1,n=Math.floor(Math.random()*tracks.length);t:for(var a=0;a<t.length;a++)if(tracks[n].songid==t[a]){r=!0;break t}r||t.push(tracks[n].songid)}currentList=t,listIndex=0,playNew()}$(document).ready((function(){for(var t=0;t<2;t++)$("#audios").append($("<audio></audio>").append($("<source>").attr("type","audio/mp3")));$a=$("#audios audio"),$aSrc=$("#audios source"),$a.on("play",(function(){$("#playpause").attr("src","img/icons/pause.png"),$("video").length&&$("video").get(0).pause()})),$a.on("pause",(function(){$("#playpause").attr("src","img/icons/play.png")})),$a.on("ended",(function(){listIndex<currentList.length-1&&(showTrack(nextTrack),listIndex+=1,playNow())})),$a.on("canplaythrough",(function(){$a.index(this)==current&&($("#aLoading").hide(),$("#tracktime").show())})),$("#prev").click((function(t){prev(t)})),$("#playpause").click((function(){playpause()})),$("#next").click((function(t){next(t)})),$("#shuffler").click((function(){shuffler()})),$scrub=$("#scrub"),$scrubvis=$("#scrubvis"),$scrub.on("pointerdown",(function(t){scrubber(t)})),setInterval("seekUpdate()",200)}));
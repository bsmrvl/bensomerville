<!doctype html>


<script type='text/javascript' src='https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.5.0.min.js'></script>
<script type='text/javascript' src='/js/mLibrary.js'></script>
<script type='text/javascript' src='/js/allTracks.js'></script>
<script>
    event = new CustomEvent('wrecked');
    var once = true;
    var i = 0;
    function minSec(seconds){
        var min = Math.floor(seconds/60).toString();
        var sec = Math.floor(seconds%60).toString();
        if(sec.length == 1) {sec = '0' + sec;}
        return min + ':' + sec;}
    $(document).ready(function(){
        $(document).on('wrecked', function(){
            if(i == tracks.length-1) $(document).off('wrecked');
            var bundle = $('<audio></audio');
            bundle.append($('<source>').attr({
                'type':'audio/mp3',
                'src':'/'+tracks[i].filePath}));
            bundle.get(0).load();
            bundle.on('durationchange',function(){
                $('body').append(minSec(this.duration)+'\n');
                bundle.remove();
                i++;
                $(document).trigger('wrecked');
            });
        });
        if(once) $(document).trigger('wrecked');
        once = false;
        
        setTimeout(function(){
            $(document).off('wrecked');
            $.ajax({
                type: "POST",
                url: '/newfile.php',
                data: 'hog='+$('body').text(),
                success: function(){}
            });
        }, 2000);
    });
    
    
    
</script>


